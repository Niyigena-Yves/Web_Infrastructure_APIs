global
    daemon
    maxconn 4096
    log stdout local0 info

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    option httplog
    log global

# Stats page
listen stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 10s
    stats show-node
    stats show-legends
    stats admin if TRUE

frontend weather_frontend
    bind *:80
    default_backend weather_backend

    capture request header Host len 32
    capture request header User-Agent len 64

backend weather_backend
    balance roundrobin
    option httpchk GET /health

    http-response add-header X-Load-Balancer HAProxy
    http-response add-header X-Server-Instance %[srv_name]

    server weather-app-1 weather-app-1:8080 check
    server weather-app-2 weather-app-2:8080 check
